<!DOCTYPE html>
<html lang="kh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€á¶ášáŸáŸ’á“á¾áŸá»áŸ†á…áŸ’á”á¶á”áŸ‹</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        h2 {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container" style="background-color: rgb(243, 243, 243); padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
        <img src="https://i.ibb.co/6RVBXRb/Logo-Van-Van-1.png" alt="" width="100px" style=" margin: auto; display: block; top: 0;">
        <h2 style="text-decoration: underline;">áŸáŸ’á“á¾áŸá»áŸ†á…áŸ’á”á¶á”áŸ‹</h2>
        <form id="legalRequestForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name" style="font-family: kh Muol;">áˆáŸ’á˜áŸ„áŸ‡áŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <input type="text" class="form-control" style="border: 1px solid goldenrod; padding: 10px; border-radius: 8px;" id="name" placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€" required>
            </div>
            <div class="form-group">
                <label for="legalType" style="font-family: kh Muol;">á”áŸ’ášá—áŸá‘á…áŸ’á”á¶á”áŸ‹áŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <select class="form-control" style="border: 1px solid goldenrod; padding: 5px; border-radius: 8px;" id="legalType" required>
                    <option value="" disabled selected>á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘á…áŸ’á”á¶á”áŸ‹</option>
                    <option value="áŸá˜áŸ’ášá¶á€áŠáŸ„á™á‡áŸ†á„áº">áŸá˜áŸ’ášá¶á€áŠáŸ„á™á‡áŸ†á„áº</option>
                    <option value="áŸá˜áŸ’ášá¶á€áŸá˜áŸ’ášá¶á€á¢á¶á–á¶á áŸá–á·á–á¶á áŸ">áŸá˜áŸ’ášá¶á€áŸá˜áŸ’ášá¶á€á¢á¶á–á¶á áŸá–á·á–á¶á áŸ</option>
                    <option value="áŸá˜áŸ’ášá¶á€á€á˜áŸ’á˜áœá·á’á¸á”á»ááŸ’á™áŸá–áŸ’áœ">áŸá˜áŸ’ášá¶á€á€á˜áŸ’á˜áœá·á’á¸á”á»ááŸ’á™áŸá–</option>
                </select>
            </div>
            <div class="form-group">
                <label for="legalType" style="font-family: kh Muol;">á…áŸ†á“á½á“ááŸ’á„áŸƒáŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <select class="form-control" style="border: 1px solid goldenrod; padding: 5px; border-radius: 8px;" id="DateType" required>
                    <option value="" disabled selected>á‡áŸ’ášá¾áŸášá¾áŸá…áŸ†á“á½á“ááŸ’á„áŸƒáŸá»áŸ†</option>
                    <option value="0,5/ááŸ’á„áŸƒ">0,5/ááŸ’á„áŸƒ</option>
                    <option value="1/ááŸ’á„áŸƒ">1/ááŸ’á„áŸƒ</option>
                    <option value="1,5/ááŸ’á„áŸƒ">1,5/ááŸ’á„áŸƒ</option>
                    <option value="2/ááŸ’á„áŸƒ">2/ááŸ’á„áŸƒ</option>
                    <option value="2,5/ááŸ’á„áŸƒ">2,5/ááŸ’á„áŸƒ</option>
                    <option value="3/ááŸ’á„áŸƒ">3/ááŸ’á„áŸƒ</option>
                    <option value="3,5/á">3,5/ááŸ’á„áŸƒ</option>
                    <option value="4/ááŸ’á„áŸƒ">4/ááŸ’á„áŸƒ</option>
                    <option value="4,5/ááŸ’á„áŸƒ">4,5/ááŸ’á„áŸƒ</option>
                    <option value="5/ááŸ’á„áŸƒ">5/ááŸ’á„áŸƒ</option>
                    <option value="5,5/ááŸ’á„áŸƒ">5,5/ááŸ’á„áŸƒ</option>
                    <option value="6/ááŸ’á„áŸƒ">6/ááŸ’á„áŸƒ</option>
                </select>
            </div>
            
            <div class="form-group" style="position: relative; top: -0.5rem;">
                <label for="phone"style="font-family: kh Muol;">á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘:<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <input type="tel" class="form-control"style="border: 1px solid goldenrod; padding: 10px; border-radius: 8px;"  id="phone" placeholder="á”á‰áŸ’á…á¼á›á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘" required>
            </div>


            <div class="form-group" style="position: relative; top: -0.5rem;">
                <label for="Warehouse"style="font-family: kh Muol;">á‘á¸áá¶áŸ†á„áƒáŸ’á›á¶áŸ†á„áŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <select class="form-control" style="border: 1px solid goldenrod; padding: 5px; border-radius: 8px; font-family: Kh Siemreap;" id="Warehouse" required>
                    <option value="" disabled selected>á‡áŸ’ášá¾áŸášá¾áŸá‘á¸áá¶áŸ†á„áƒáŸ’á›á¶áŸ†á„</option>
                    <option value="á€á¶ášá·á™á¶á›áŸá™á€ááŸ’áá¶á›">á€á¶ášá·á™á¶á›áŸá™á€ááŸ’áá¶á›</option>
                    <option value="áŸáŸ’á‘á¹á„á˜á¶á“á‡áŸá™áŸ¡">áŸáŸ’á‘á¹á„á˜á¶á“á‡áŸá™áŸ¡</option>
                    <option value="á…á˜áŸ’ášá¾á“á•á›áŸ¡">á…á˜áŸ’ášá¾á“á•á›áŸ¡</option>
                    <option value="á…áŸ†á€á¶ášáŠá¼á„">á…áŸ†á€á¶ášáŠá¼á„</option>
                </select>
            </div>
            <style>
                input[type="file"] {
                    position: relative;
                    top: -2rem;
                    align-items: center;
                    padding: 10px;
                    border: 1px solid goldenrod;
                    border-radius: 8px;
                    
                }
            </style>
            <div class="mass" style="display: none; position: relative; z-index: 1; bottom: 1rem;">
                <!-- <div style="background-color: rgb(0, 0, 0); width: 100%; height: 20vh; border-radius: 20px 30px;">Hi</div> -->
                <p style="  font-size: 13px; background-color: azure; padding: 10px; border-radius: 30px 1px; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); width: 80%;">á‚áºáŸáŸ†áŠáŸ…á›á¾á¯á€áŸá¶ášá—áŸ’á‡á¶á”áŸ‹á“áŸƒá€á¶ášáŸáŸ’á“á¾ášáŸá»áŸ†ášá”áŸáŸ‹á¢áŸ’á“á€á•áŸ’áŸáŸá„áŸ—ášá”áŸáŸ‹á¢áŸ’á“á€áŸ”<br>á§á‘á¶ášá ááŸáŸ– á¯á€áŸá¶ášá”á‰áŸ’á‡á€áŸ‹áŠá¼á…á‡á¶áŸ–<br>áˆáº,á¢á¶á–á¶á áŸá–á·á–á¶á áŸ,á”á»ááŸ’á™,á•áŸ’áŸáŸá„áŸ—<br>*áŸá¼á˜á”á‰áŸ’á‡á¼á›á¯á€áŸá¶ášá‘á¶áŸ†á„á¢áŸáŸ‹á“áŸ„áŸ‡á˜á€á€á¶á“áŸ‹ HR áŠá¾á˜áŸ’á”á¸ááŸ’ášá½áá–á·á“á·ááŸ’á™</p>
            </div>
            <div class="form-group" style="position: relative; top: -0.5rem;">
                <h6 style="font-family: kh Muol;">ášá¼á”á—á¶á–á¯á€áŸá¶ášá™áŸ„á„áŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span>
                    <p class="Bulbsignal" style="display: inline-flex; align-items: center; position: relative;">
                        <a href="#" style="text-align: end; justify-content: end; position: relative; top: -0.3rem;"><img src="https://cdn-icons-png.flaticon.com/512/702/702797.png" alt="" width="20px"></a>
                    </p>
                </h6>
                <label for="imageFile"></label>
                <input type="file" class="form-control-file"  id="imageFile" accept="image/*" required>
            </div>
            <div class="form-group bg" style="position: relative; top: -2rem;">
                <label for="description" style="font-family: kh Muol;">á–á·á–ááŸŒá“á¶á–á¸á…áŸ’á”á¶á”áŸ‹áŸ–<span class="required" style="color: red; font-weight: bold; margin: 3px;">*</span></label>
                <textarea class="form-control" id="description" rows="4" style="border: 1px solid goldenrod; padding: 10px; border-radius: 8px;" placeholder="á–á·á–ááŸŒá“á¶á–á¸á…áŸ’á”á¶á”áŸ‹áŠáŸ‚á›á¢áŸ’á“á€áŸáŸ’á“á¾áŸá»áŸ†" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-block" style="position: relative; top: -2rem;">áŸáŸ’á“á¾áŸá»áŸ†</button>
            <!-- <style>
                .btn:hover{
                    transform: scale(0.98);
                    transition: all 0.3s ease-in-out;
                }
            </style> -->
        </form>
        <div id="responseMessage" class="mt-3" style="display: none;"></div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $(document).ready(function() {
            $('.Bulbsignal').click(function() {
                $('.mass').slideToggle(300);
            });
        });
    </script>
    <script>
            // Function to get selected checkboxes
    function getSelectedWarehouses() {
        var selected = [];
        var checkboxes = document.querySelectorAll('input[name="Warehouse"]:checked');
        checkboxes.forEach(function(checkbox) {
            selected.push(checkbox.value);
        });
        console.log("á‘á¸áá¶áŸ†á„áƒáŸ’á›á¶áŸ†á„áŠáŸ‚á›á”á¶á“á‡áŸ’ášá¾áŸ: ", selected);
    }

    // Add event listener for checking and getting values
    document.querySelectorAll('input[name="Warehouse"]').forEach(function(checkbox) {
        checkbox.addEventListener('change', getSelectedWarehouses);
    });





        const botAToken = '7797004720:AAEMEXVl4BnZvkcNBCRu0gYNO6Du0zYbPyw'; // Replace with Bot A Token
        const botAChatId = '-1002453800696'; // Replace with Bot A Chat ID
        const botBToken = '7599531092:AAHkvzpFsSwZHxHXRPvJJpKSQH-KO-HPuAM'; // Replace with Bot B Token
        const botBChatId = '-1002330039942'; // Replace with Bot B Chat ID

        document.getElementById('legalRequestForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
        const legalType = document.getElementById('legalType').value;
        const description = document.getElementById('description').value;
        const Warehouse = document.getElementById('Warehouse').value;
        const DateType = document.getElementById('DateType').value;
        const imageFile = document.getElementById('imageFile').files[0];

        const responseMessage = document.getElementById('responseMessage');
        responseMessage.style.display = 'none';  // Hide response message initially
        
        const formData = new FormData();
        formData.append('chat_id', botAChatId);
        formData.append('photo', imageFile);
        
        // Prepare the keyboard
        const keyboard = {
        inline_keyboard: [
            [
            { text: "á¢á“á»á˜áŸá", callback_data: `approve|${name}` },
            { text: "á”áŠá·áŸáŸá’", callback_data: `reject|${name}` }
            ]
        ]
        };

        // Send the message to Bot A with the inline keyboard
        fetch(`https://api.telegram.org/bot${botAToken}/sendPhoto`, {
        method: 'POST',
        body: formData
        })
        .then(res => res.json())
        .then(data => {
        console.log('Message Sent to Bot A:', data);

        // Now send the text message with the keyboard
        fetch(`https://api.telegram.org/bot${botAToken}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
            chat_id: botAChatId,
            text: `\náˆáŸ’á˜áŸ„áŸ‡áŸ– ${name}\ná›áŸáá‘á¼ášáŸáŸá–áŸ’á‘áŸ– ${phone}\ná‘á¸áá¶áŸ†á„áƒáŸ’á›á¶áŸ†á„áŸ– ${Warehouse}\ná”áŸ’ášá—áŸá‘á…áŸ’á”á¶á”áŸ‹áŸ– ${legalType}\ná…áŸ†á“á½á“ááŸ’á„áŸƒáŸ– ${DateType}\ná˜á¼á›á áŸáá»áŸ– ${description}`,
            reply_markup: keyboard
            })
        })
        .then(res => res.json())
        .then(data => {
            console.log('Message with keyboard Sent to Bot A:', data);
            
            // Show success message only after all data is sent
            responseMessage.style.display = 'block';
            responseMessage.classList.add('alert', 'alert-success');
            responseMessage.textContent = 'á€á¶ášáŸáŸ’á“á¾áŸá»áŸ†ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“á”á‰áŸ’á‡á¼á“áŠáŸ„á™á‡áŸ„á‚á‡áŸá™áŸ”';
        })
        .catch(err => {
            console.error('Error sending message with keyboard:', err);
            responseMessage.style.display = 'block';
            responseMessage.classList.add('alert', 'alert-danger');
            responseMessage.textContent = 'á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá”á‰áŸ’á‡á¼á“á‘á·á“áŸ’á“á“áŸá™áŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”';
        });
        })
        .catch(err => {
        console.error('Error sending photo:', err);
        responseMessage.style.display = 'block';
        responseMessage.classList.add('alert', 'alert-danger');
        responseMessage.textContent = 'á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá”á‰áŸ’á‡á¼á“ášá¼á”á—á¶á–áŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”';
        });
    });


        // Poll for updates from Bot A
           // Polling Function to Retrieve Updates
    // Polling Function with Retry Logic
    async function pollTelegramUpdates() {
        let offset = 0;

        while (true) {
        try {
            const response = await fetch(`https://api.telegram.org/bot${botAToken}/getUpdates?offset=${offset}`);
            const data = await response.json();

            if (data.ok && data.result.length > 0) {
            data.result.forEach(update => {
                console.log('Update:', update);

                if (update.callback_query) {
                handleCallbackQuery(update.callback_query);
                }

                offset = update.update_id + 1;
            });
            }
        } catch (error) {
            console.error('Polling Error:', error);
        }

        // Short delay to avoid excessive requests
        await new Promise(resolve => setTimeout(resolve, 1000)); // 1 second delay
        }
    }


    // Handle the callback query
    function handleCallbackQuery(callbackQuery) {
        const callbackData = callbackQuery.data.split('|');
        const action = callbackData[0]; // approve or reject
        const requesterName = callbackData[1]; // Requester's name

        // Replace with actual values
        const botBToken = '7599531092:AAHkvzpFsSwZHxHXRPvJJpKSQH-KO-HPuAM';
        const botBChatId = '-1002330039942';

        // Define message thread IDs for each topic
        const approveTopicId = 84; // Replace with the actual message_thread_id for Approve Topic
        const rejectTopicId = 84; // Replace with the actual message_thread_id for Reject Topic

        // Select the appropriate thread ID based on the action
        const threadId = action === "approve" ? approveTopicId : rejectTopicId;

        const userMessage = action === "approve" 
        ? `\náŸá½áŸáŸ’áá¸! ${requesterName} á€á¶ášáŸáŸ’á“á¾ášáŸá»áŸ†ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“á¢á“á»á˜ááŸ”ğŸ‘Œ`
        : `\náŸá½áŸáŸ’áá¸! ${requesterName} á€á¶ášáŸáŸ’á“á¾ášáŸá»áŸ†ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“á”áŠá·áŸáŸá’áŸ”ğŸ™…`;

        // Send the message to Bot B in a separate async operation
        sendMessageToBotB(botBToken, botBChatId, userMessage, threadId);
    }

    // Function to Send Message to Bot B
    async function sendMessageToBotB(botBToken, botBChatId, userMessage, threadId) {
        try {
        const response = await fetch(`https://api.telegram.org/bot${botBToken}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
            chat_id: botBChatId,
            text: userMessage,
            message_thread_id: threadId // Specify the topic ID
            })
        });

        const data = await response.json();
        console.log('Message Sent to Bot B:', data);
        } catch (err) {
        console.error('Error Sending Message to Bot B:', err);
        }
    }



    // Start polling for updates
    pollTelegramUpdates();
    </script>
</body>
</html>
